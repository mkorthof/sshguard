#!/bin/sh
# sshg-fw -- control firewall backends
# This file is part of SSHGuard.

# DEVELOPER NOTE: sshg-fw is built from sshg-fw.in and the backend script
# only when the 'configure' script is run. If you change either source files,
# you should re-run 'configure'.

@sshg_fw_subr@

die() {
    echo "sshg-fw: $2" >&2
    exit $1
}

fw_init || die 69 "Could not initialize firewall"

cleanup() {
    trap "" EXIT
    if [ "YES" = "$flushonexit" ]; then
        fw_flush
    fi
    fw_fin
}

trap cleanup EXIT INT

while read cmd address addrtype; do
    case $cmd in
        block)
            fw_block $address $addrtype;;
        release)
            fw_release $address $addrtype;;
        flush)
            fw_flush;;
        flushonexit)
            flushonexit=YES;;
        *)
            die 65 "Invalid command";;
    esac
done
